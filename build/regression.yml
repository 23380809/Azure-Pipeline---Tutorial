trigger:
  - none

resources:
  repositories:
    - repository: robot_automation
      type: git
      name: Shawn-web/robot_automation
      ref: master

stages:
- stage: Setup
  pool:
    name: Automation-Pool
  jobs:
  - job: fetch_test_repos
    displayName: fetch_test_repos
    steps:
      - checkout: robot_automation
        fetchDepth: 0
      - publish: $(System.DefaultWorkingDirectory)
        artifact: repos
      - task: DownloadPipelineArtifact@2
        inputs:
          buildType: "current"
          artifactName: "repos"
          targetPath: '$(Pipeline.Workspace)/s/repos/robot_automation'

- stage: Regression
  dependsOn: Setup
  pool:
    name: Automation-Pool
  jobs:
  - job: api_automation
    displayName: api_automation
    steps:
      - bash: |
          cd /
          cd $(Pipeline.Workspace)/s/repos/robot_automation
          robot --outputdir log api_testcase
      - task: PublishBuildArtifacts@1
        inputs:
          pathToPublish: $(Pipeline.Workspace)/s/repos/robot_automation/log
          artifactName: log
        